(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[663],{4461:function(e,t,r){Promise.resolve().then(r.bind(r,6476))},6476:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var a=r(7437),s=r(2265),i=r(4033),n=r(5922),l=r(5754),o=r(5438),c=r(1396),d=r.n(c);function m(e){let{children:t}=e,[r,c]=(0,s.useState)(null),[m,x]=(0,s.useState)([]),[u,h]=(0,s.useState)([]),[g,f]=(0,s.useState)(!1),[y,p]=(0,s.useState)(!0),v=(0,i.useRouter)(),b=async e=>{try{let{data:t,error:r}=await n.O.from("org_members").select("org_id, organizations(*)").eq("user_id",e).eq("role","owner").single();if(t){console.log("Admin already has organization:",t.organizations);return}console.log("Creating admin organization...");let{data:a,error:s}=await n.O.from("organizations").insert({name:"Timeline Alchemy Admin",plan:"enterprise"}).select().single();if(s||!a){console.error("Error creating admin organization:",s);return}let{error:i}=await n.O.from("org_members").insert({org_id:a.id,user_id:e,role:"owner"});i&&console.error("Error adding admin to organization:",i),await n.O.from("subscriptions").insert({org_id:a.id,stripe_customer_id:"admin-"+a.id,stripe_subscription_id:"admin-sub-"+a.id,plan:"enterprise",status:"active"})}catch(e){console.error("Error ensuring admin organization:",e)}};(0,s.useEffect)(()=>{(async()=>{var e,t,r;let{data:{user:a}}=await n.O.auth.getUser();if(!a){v.push("/auth/signin");return}c({id:a.id,email:a.email||"",name:(null===(e=a.user_metadata)||void 0===e?void 0:e.name)||(null===(t=a.email)||void 0===t?void 0:t.split("@")[0]),avatar_url:null===(r=a.user_metadata)||void 0===r?void 0:r.avatar_url,created_at:a.created_at});let s="sh4m4ni4k@sh4m4ni4k.nl"===a.email;if(f(s),s){await b(a.id);let{data:e,error:t}=await n.O.from("organizations").select("\n            *,\n            subscriptions!inner(status)\n          ").eq("subscriptions.status","active").order("created_at",{ascending:!1});console.log("Admin organizations query result:",{orgs:e,orgError:t}),e&&x(e);let{data:r,error:s}=await n.O.from("clients").select("\n            *,\n            organizations(name, plan)\n          ").order("created_at",{ascending:!1});r&&h(r)}else{let{data:e,error:t}=await n.O.from("org_members").select("\n            *,\n            organizations (*)\n          ").eq("user_id",a.id);e&&e.length>0?x(e.map(e=>e.organizations)):(console.log("No organization found for user. This might be a new user - organization should be created automatically."),setTimeout(async()=>{let{data:e,error:t}=await n.O.from("org_members").select("\n                *,\n                organizations (*)\n              ").eq("user_id",a.id);e&&e.length>0&&x(e.map(e=>e.organizations))},2e3))}p(!1)})();let{data:{subscription:e}}=n.O.auth.onAuthStateChange((e,t)=>{"SIGNED_OUT"!==e&&t||v.push("/auth/signin")});return()=>e.unsubscribe()},[v]);let j=async()=>{await n.O.auth.signOut(),v.push("/")};return y?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900",children:[(0,a.jsx)("header",{className:"bg-gray-800 shadow-sm border-b border-gray-700",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)(d(),{href:"/dashboard",className:"flex items-center",children:[(0,a.jsx)(o.T,{size:"md",showText:!1}),(0,a.jsx)("span",{className:"ml-3 text-xl font-bold text-gray-900 dark:text-white",children:"Timeline Alchemy"})]})}),(0,a.jsxs)("nav",{className:"hidden md:flex space-x-8",children:[(0,a.jsx)(d(),{href:"/dashboard",className:"text-gray-300 hover:text-yellow-400",children:"Dashboard"}),(0,a.jsx)(d(),{href:"/dashboard/content",className:"text-gray-300 hover:text-yellow-400",children:"Content"}),(0,a.jsx)(d(),{href:"/dashboard/schedule",className:"text-gray-300 hover:text-yellow-400",children:"Schedule"}),(0,a.jsx)(d(),{href:"/dashboard/socials",className:"text-gray-300 hover:text-yellow-400",children:"Socials"}),(0,a.jsx)(d(),{href:"/dashboard/billing",className:"text-gray-300 hover:text-yellow-400",children:"Billing"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-300",children:[(null==r?void 0:r.name)||(null==r?void 0:r.email),g&&(0,a.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-yellow-600 text-yellow-100 rounded-full",children:"ADMIN"})]}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",onClick:j,children:"Sign Out"})]})]})})}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("aside",{className:"w-64 bg-gray-800 shadow-sm min-h-screen border-r border-gray-700",children:(0,a.jsx)("div",{className:"p-6",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Active Organizations"}),(0,a.jsx)("div",{className:"space-y-2 mb-6",children:m.map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-gray-700 hover:bg-gray-600 cursor-pointer",children:[(0,a.jsx)("div",{className:"font-medium text-white",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-400 capitalize",children:e.plan}),(0,a.jsx)("div",{className:"text-xs text-green-400",children:"Active"})]},e.id))}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Active Clients"}),(0,a.jsx)("div",{className:"space-y-2",children:u.map(e=>{var t,r;return(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-gray-700 hover:bg-gray-600 cursor-pointer",children:[(0,a.jsx)("div",{className:"font-medium text-white",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-400",children:(null===(t=e.contact_info)||void 0===t?void 0:t.email)||"No email"}),(0,a.jsx)("div",{className:"text-xs text-blue-400",children:(null===(r=e.organizations)||void 0===r?void 0:r.name)||"Unknown Org"})]},e.id)})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"My Organizations"}),(0,a.jsx)("div",{className:"space-y-2",children:m.map(e=>(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-gray-700 hover:bg-gray-600 cursor-pointer",children:[(0,a.jsx)("div",{className:"font-medium text-white",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-400 capitalize",children:e.plan})]},e.id))})]})})}),(0,a.jsx)("main",{className:"flex-1 p-6",children:t})]})]})}},5438:function(e,t,r){"use strict";r.d(t,{T:function(){return s}});var a=r(7437);r(2265);let s=e=>{let{className:t="",size:r="md",showText:s=!0}=e,i={sm:40,md:60,lg:80,xl:120};return(0,a.jsxs)("div",{className:"flex flex-col items-center ".concat(t),children:[(0,a.jsxs)("div",{className:"relative ".concat({sm:"h-8 w-8",md:"h-12 w-12",lg:"h-16 w-16",xl:"h-24 w-24"}[r]),children:[(0,a.jsx)("svg",{viewBox:"-".concat(i[r]," -").concat(i[r]," ").concat(2*i[r]," ").concat(2*i[r]),className:"absolute inset-0 w-full h-full",style:{transform:"scale(1.8)"},children:[...Array(24)].map((e,t)=>{let s=15*t*Math.PI/180,n=.4*i[r]*Math.cos(s),l=.4*i[r]*Math.sin(s),o=.7*i[r]*Math.cos(s),c=.7*i[r]*Math.sin(s);return(0,a.jsx)("line",{x1:n,y1:l,x2:o,y2:c,stroke:"#D4AF37",strokeWidth:"1.5",opacity:"0.8"},t)})}),(0,a.jsxs)("svg",{viewBox:"0 0 100 120",className:"w-full h-full relative z-10",style:{filter:"drop-shadow(0 0 8px rgba(212, 175, 55, 0.6))"},children:[(0,a.jsx)("path",{d:"M20 10 L80 10 L80 20 Q80 35 65 40 L50 50 L65 60 Q80 65 80 80 L80 110 L20 110 L20 80 Q20 65 35 60 L50 50 L35 40 Q20 35 20 20 L20 10 Z",fill:"none",stroke:"#D4AF37",strokeWidth:"2"}),(0,a.jsx)("rect",{x:"18",y:"8",width:"64",height:"4",fill:"#D4AF37",rx:"2"}),(0,a.jsx)("rect",{x:"18",y:"108",width:"64",height:"4",fill:"#D4AF37",rx:"2"}),(0,a.jsx)("path",{d:"M45 25 Q50 20 55 25 Q60 30 58 35 L56 38 Q52 40 48 38 L42 35 Q40 30 42 28 Q43 26 45 25 Z",fill:"#DEB887",opacity:"0.9"}),(0,a.jsx)("circle",{cx:"35",cy:"22",r:"1.5",fill:"#D4AF37",opacity:"0.7"}),(0,a.jsx)("circle",{cx:"65",cy:"28",r:"1",fill:"#D4AF37",opacity:"0.6"}),(0,a.jsx)("circle",{cx:"40",cy:"32",r:"0.8",fill:"#DEB887",opacity:"0.8"}),(0,a.jsx)("circle",{cx:"60",cy:"35",r:"1.2",fill:"#DEB887",opacity:"0.7"}),(0,a.jsx)("path",{d:"M48 42 Q50 45 52 48 Q50 52 48 55",stroke:"#DEB887",strokeWidth:"0.8",fill:"none",opacity:"0.6"}),(0,a.jsx)("path",{d:"M25 95 Q35 85 50 88 Q65 85 75 95 L75 105 L25 105 Z",fill:"#DEB887",opacity:"0.8"}),(0,a.jsxs)("g",{fill:"#D4AF37",opacity:"0.8",children:[(0,a.jsx)("path",{d:"M30 18 L31 20 L33 19 L31 21 L30 23 L29 21 L27 19 L29 20 Z"}),(0,a.jsx)("path",{d:"M70 25 L71 27 L73 26 L71 28 L70 30 L69 28 L67 26 L69 27 Z"}),(0,a.jsx)("path",{d:"M50 15 L51.5 17 L54 16 L51.5 18.5 L50 21 L48.5 18.5 L46 16 L48.5 17 Z"})]}),(0,a.jsxs)("g",{fill:"#D4AF37",opacity:"0.8",children:[(0,a.jsx)("path",{d:"M35 75 L36 77 L38 76 L36 78 L35 80 L34 78 L32 76 L34 77 Z"}),(0,a.jsx)("path",{d:"M65 82 L66 84 L68 83 L66 85 L65 87 L64 85 L62 83 L64 84 Z"}),(0,a.jsx)("path",{d:"M50 70 L51.5 72 L54 71 L51.5 73.5 L50 76 L48.5 73.5 L46 71 L48.5 72 Z"})]}),(0,a.jsx)("circle",{cx:"25",cy:"25",r:"0.8",fill:"#D4AF37",opacity:"0.6"}),(0,a.jsx)("circle",{cx:"75",cy:"32",r:"0.6",fill:"#D4AF37",opacity:"0.5"}),(0,a.jsx)("circle",{cx:"30",cy:"85",r:"0.7",fill:"#D4AF37",opacity:"0.6"}),(0,a.jsx)("circle",{cx:"70",cy:"90",r:"0.9",fill:"#D4AF37",opacity:"0.5"})]})]}),s&&(0,a.jsxs)("div",{className:"mt-2 text-center font-serif font-bold ".concat({sm:"text-xs",md:"text-sm",lg:"text-lg",xl:"text-2xl"}[r]," text-gray-900 dark:text-gray-100 leading-tight"),children:[(0,a.jsx)("div",{className:"text-yellow-700 dark:text-yellow-300",children:"TIMELINE"}),(0,a.jsx)("div",{className:"text-yellow-700 dark:text-yellow-300 -mt-1",children:"ALCHEMY"})]})]})}},5754:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var a=r(7437),s=r(2265),i=r(7256),n=r(6061),l=r(1657);let o=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:c=!1,...d}=e,m=c?i.g7:"button";return(0,a.jsx)(m,{className:(0,l.cn)(o({variant:s,size:n,className:r})),ref:t,...d})});c.displayName="Button"},5922:function(e,t,r){"use strict";r.d(t,{O:function(){return o}});var a=r(5257),s=r(2601);let i="https://zkydbbarowexcqhsurky.supabase.co",n="your_supaba=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpreWRiYmFyb3dleGNxaHN1cmt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4MjQwMTksImV4cCI6MjA3NDQwMDAxOX0.k9PDWkCirDd-9_C7KamuWOULqcuMjw1KuZz5wx95EPs",l=null,o=(0,a.eI)(i,n,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}});(0,a.eI)(i,s.env.SUPABASE_SERVICE_ROLE_KEY||n,{auth:{autoRefreshToken:!1,persistSession:!1}})},1657:function(e,t,r){"use strict";r.d(t,{cn:function(){return i},o0:function(){return l},p6:function(){return n}});var a=r(7042),s=r(4769);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}function n(e){return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(new Date(e))}function l(e){return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}).format(new Date(e))}},4033:function(e,t,r){e.exports=r(5313)}},function(e){e.O(0,[849,985,448,971,938,744],function(){return e(e.s=4461)}),_N_E=e.O()}]);